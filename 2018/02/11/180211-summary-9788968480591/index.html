<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Haeseong Jeon"><title>이것이 레디스다 요약 (실습 제외) · 과제요정</title><meta name="description" content="이것이 레디스다참고문헌정경석. 이것이 레디스다. 서울:한빛미디어. 2013.
1장 들어가며빅데이터란 무엇인가?일반적으로는 대략 10테라바이트에서 10페타바이트 정도의 데이터를 일컫는다.빅데이터에 대한 정의는 크게 두 가지다. 하나는 2011년도에 MGI에서 정의한 데이"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">과제요정</a></h3></div></div><ul class="social-links"></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">Home</a></li><li><a href="/about">Sobre</a></li><li><a href="/archives">Arquivo</a></li><li><a href="/links">Links</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>이것이 레디스다 요약 (실습 제외)</a></h3></div><div class="post-content"><h1 id="이것이-레디스다"><a href="#이것이-레디스다" class="headerlink" title="이것이 레디스다"></a>이것이 레디스다</h1><h3 id="참고문헌"><a href="#참고문헌" class="headerlink" title="참고문헌"></a>참고문헌</h3><p><a href="http://www.kyobobook.co.kr/product/detailViewKor.laf?ejkGb=KOR&amp;mallGb=KOR&amp;barcode=9788968480591&amp;orderClick=LAG&amp;Kc=" target="_blank" rel="noopener">정경석. <em>이것이 레디스다</em>. 서울:한빛미디어. 2013.</a></p>
<h2 id="1장-들어가며"><a href="#1장-들어가며" class="headerlink" title="1장 들어가며"></a>1장 들어가며</h2><h3 id="빅데이터란-무엇인가"><a href="#빅데이터란-무엇인가" class="headerlink" title="빅데이터란 무엇인가?"></a>빅데이터란 무엇인가?</h3><p>일반적으로는 대략 10테라바이트에서 10페타바이트 정도의 데이터를 일컫는다.<br>빅데이터에 대한 정의는 크게 두 가지다. 하나는 2011년도에 MGI에서 정의한 데이터베이스의 규모(데이터의 크기)에 기반한 분류 방법이고 다른 하나는 같은 해 EMC에서 정의한 데이터의 처리 방법에 기반한 분류 방법이다.<br>빅데이터의 두 번째 정의는 데이터의 처리방식에 기반하여 분류하는 것을 말하며, 정형화된 데이터가 아닌 비정형 데이터를 처리하는 기술 및 아키텍처를 말한다. </p>
<h3 id="NoSQL의-탄생-배경"><a href="#NoSQL의-탄생-배경" class="headerlink" title="NoSQL의 탄생 배경"></a>NoSQL의 탄생 배경</h3><p>전통적인 데이터 처리 방법인 SQL 데이터베이스 또는 전통적인 데이터 처리 애플리케이션만으로는 처리가 불가능한 크기의 데이터를 처리하기 위해 나온 기술들의 총칭이 NoSQL 이다. </p>
<p>각 단일 서버(하드웨어)의 성능을 증가시켜서 더 많은 요청을 처리하는 방법을 스케일 업(scale up)이라고 한다. 동일한 사양의 새로운 서버(하드웨어)를 추가하는 방법을 스케일 아웃(scale out)이라고 한다. 통상적으로 스케일 업을 적용하면 서비스의 중단이나 추가 하드웨어 비용이 발생한다.<br>스케일 업은 명확한 한계가 존재한다. 하나의 장비에 설치할 수 있는 CPU 및 메모리와 디스크 수에는 한계가 있기 때문이다. 또한 소프트웨어 구조상 아무리 스케일 업을 한다고 해도 상승 가능한 물리적인 한계가 존재한다. </p>
<p>이에 반해서 대부분의 NoSQL은 처음부터 스케일 아웃을 염두에 두고 설계되었기 때문에 데이터의 증가나 요청량이 증가하더라도 동일하거나 비슷한 사양의 새로운 하드웨어를 추가하면 대응이 가능하다. </p>
<h3 id="레디스와-멤캐시드"><a href="#레디스와-멤캐시드" class="headerlink" title="레디스와 멤캐시드"></a>레디스와 멤캐시드</h3><p>멤캐시드(Memcached)와 레디스를 같은 캐시 시스템으로서 동등한 위치에서 비교하게 된 것은 레디스가 멤캐시드와 동일한 기능을 제공하면서 영속성, 다양한 데이터 구조와 같은 부가적인 기능을 지원하기 때문이다. 또한 특정한 조건에서는 멤캐시드에 비해서 더 나은 성능을 보여주기도 한다. 이와 같은 이유로 레디스는 맴캐시드를 대체하는 솔루션으로서 각광받고 있다. </p>
<h3 id="레디스의-개요"><a href="#레디스의-개요" class="headerlink" title="레디스의 개요"></a>레디스의 개요</h3><p>레디스는 모든 데이터를 메모리에 저장하고 조회한다. 즉, 인메모리 데이터베이스 솔루션이다. 다른 인메모리 솔루션들과의 차이점 중 가장 특별한 점은 레디스의 ‘다양한 자료구조’다. </p>
<ul>
<li>영속성을 지원하는 인메모리 데이터 저장소다. </li>
<li>읽기 성능 증대를 위한 서버 측 복제를 지원한다.</li>
<li>쓰기 성능 증대를 위한 클라이언트 측 샤딩(Sharding)을 지원한다. </li>
<li>ANSI C로 작성됐다. 따라서 ANSI C 컴파일러가 동작하는 곳이면 어디든 설치 및 실행이 가능하다. </li>
<li>레디스 클라이언트는 대부분의 언어로 포팅되어 있다. </li>
<li>네이버, 라인, 깃허브, 블리자드, 트웻덱, 야후 플리커, 중국 시나웨이보 등 많은 서비스에서 사용되고 있으며 성능적으로 검증된 솔루션이다. </li>
<li>문자열, 리스트, 해시, 셋, 정렬된 셋과 같은 다양한 데이터형을 지원한다. 메모리 저장소임에도 불구하고 많은 데이터형을 지원하므로 다양한 기능을 구현할 수 있다. </li>
</ul>
<blockquote>
<p>레디스는 고성능 키-값 저장소로서 문자열, 리스트, 해시, 셋, 정렬된 셋 형식의 데이터를 지원하는 NoSQL 이다.</p>
</blockquote>
<h2 id="2장-빨리-시작해보기"><a href="#2장-빨리-시작해보기" class="headerlink" title="2장 빨리 시작해보기"></a>2장 빨리 시작해보기</h2><ul>
<li>리눅스 환경에 설치하기</li>
<li>윈도우 환경에 설치하기</li>
<li><p>간단한 레디스 명령 실행하기</p>
<ul>
<li>레디스 성능 측정</li>
<li><p>redis-benchmark 명령을 실행하면 아래와 같은 로그와 함께 성능 측정 결과가 출력된다. </p>
<details><br>  <sumary>redis-benchmark</sumary><br><br>  <figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">Redis</span>&gt;<span class="title">redis</span>-<span class="title">benchmark</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">====== <span class="title">PING_INLINE</span> ======</span></span><br><span class="line"><span class="function">100000 <span class="title">requests</span> <span class="title">completed</span> <span class="title">in</span> 1.80 <span class="title">seconds</span></span></span><br><span class="line"><span class="function">50 <span class="title">parallel</span> <span class="title">clients</span></span></span><br><span class="line"><span class="function">3 <span class="title">bytes</span> <span class="title">payload</span></span></span><br><span class="line"><span class="function"><span class="title">keep</span> <span class="title">alive</span>: 1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">88.10% &lt;= 1 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">95.23% &lt;= 2 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.86% &lt;= 3 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.94% &lt;= 4 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.98% &lt;= 5 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">100.00% &lt;= 5 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">55432.37 <span class="title">requests</span> <span class="title">per</span> <span class="title">second</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">====== <span class="title">PING_BULK</span> ======</span></span><br><span class="line"><span class="function">100000 <span class="title">requests</span> <span class="title">completed</span> <span class="title">in</span> 1.66 <span class="title">seconds</span></span></span><br><span class="line"><span class="function">50 <span class="title">parallel</span> <span class="title">clients</span></span></span><br><span class="line"><span class="function">3 <span class="title">bytes</span> <span class="title">payload</span></span></span><br><span class="line"><span class="function"><span class="title">keep</span> <span class="title">alive</span>: 1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">89.51% &lt;= 1 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.51% &lt;= 2 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.93% &lt;= 3 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.98% &lt;= 4 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">100.00% &lt;= 5 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">100.00% &lt;= 5 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">60096.15 <span class="title">requests</span> <span class="title">per</span> <span class="title">second</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">====== <span class="title">SET</span> ======</span></span><br><span class="line"><span class="function">100000 <span class="title">requests</span> <span class="title">completed</span> <span class="title">in</span> 1.75 <span class="title">seconds</span></span></span><br><span class="line"><span class="function">50 <span class="title">parallel</span> <span class="title">clients</span></span></span><br><span class="line"><span class="function">3 <span class="title">bytes</span> <span class="title">payload</span></span></span><br><span class="line"><span class="function"><span class="title">keep</span> <span class="title">alive</span>: 1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">86.08% &lt;= 1 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">98.35% &lt;= 2 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.44% &lt;= 3 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.61% &lt;= 4 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.74% &lt;= 5 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.82% &lt;= 6 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.88% &lt;= 7 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.95% &lt;= 8 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.98% &lt;= 9 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.99% &lt;= 10 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">100.00% &lt;= 10 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">57110.22 <span class="title">requests</span> <span class="title">per</span> <span class="title">second</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">====== <span class="title">GET</span> ======</span></span><br><span class="line"><span class="function">100000 <span class="title">requests</span> <span class="title">completed</span> <span class="title">in</span> 1.61 <span class="title">seconds</span></span></span><br><span class="line"><span class="function">50 <span class="title">parallel</span> <span class="title">clients</span></span></span><br><span class="line"><span class="function">3 <span class="title">bytes</span> <span class="title">payload</span></span></span><br><span class="line"><span class="function"><span class="title">keep</span> <span class="title">alive</span>: 1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">91.87% &lt;= 1 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.94% &lt;= 2 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.97% &lt;= 3 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">100.00% &lt;= 4 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">100.00% &lt;= 4 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">62034.74 <span class="title">requests</span> <span class="title">per</span> <span class="title">second</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">====== <span class="title">INCR</span> ======</span></span><br><span class="line"><span class="function">100000 <span class="title">requests</span> <span class="title">completed</span> <span class="title">in</span> 1.67 <span class="title">seconds</span></span></span><br><span class="line"><span class="function">50 <span class="title">parallel</span> <span class="title">clients</span></span></span><br><span class="line"><span class="function">3 <span class="title">bytes</span> <span class="title">payload</span></span></span><br><span class="line"><span class="function"><span class="title">keep</span> <span class="title">alive</span>: 1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">88.67% &lt;= 1 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.91% &lt;= 2 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.96% &lt;= 3 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.99% &lt;= 4 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">100.00% &lt;= 4 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">59808.61 <span class="title">requests</span> <span class="title">per</span> <span class="title">second</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">====== <span class="title">LPUSH</span> ======</span></span><br><span class="line"><span class="function">100000 <span class="title">requests</span> <span class="title">completed</span> <span class="title">in</span> 1.65 <span class="title">seconds</span></span></span><br><span class="line"><span class="function">50 <span class="title">parallel</span> <span class="title">clients</span></span></span><br><span class="line"><span class="function">3 <span class="title">bytes</span> <span class="title">payload</span></span></span><br><span class="line"><span class="function"><span class="title">keep</span> <span class="title">alive</span>: 1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">88.91% &lt;= 1 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.89% &lt;= 2 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.96% &lt;= 3 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">100.00% &lt;= 4 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">100.00% &lt;= 4 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">60642.81 <span class="title">requests</span> <span class="title">per</span> <span class="title">second</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">====== <span class="title">RPUSH</span> ======</span></span><br><span class="line"><span class="function">100000 <span class="title">requests</span> <span class="title">completed</span> <span class="title">in</span> 1.69 <span class="title">seconds</span></span></span><br><span class="line"><span class="function">50 <span class="title">parallel</span> <span class="title">clients</span></span></span><br><span class="line"><span class="function">3 <span class="title">bytes</span> <span class="title">payload</span></span></span><br><span class="line"><span class="function"><span class="title">keep</span> <span class="title">alive</span>: 1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">90.43% &lt;= 1 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.90% &lt;= 2 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.99% &lt;= 3 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">100.00% &lt;= 3 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">59171.59 <span class="title">requests</span> <span class="title">per</span> <span class="title">second</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">====== <span class="title">LPOP</span> ======</span></span><br><span class="line"><span class="function">100000 <span class="title">requests</span> <span class="title">completed</span> <span class="title">in</span> 1.65 <span class="title">seconds</span></span></span><br><span class="line"><span class="function">50 <span class="title">parallel</span> <span class="title">clients</span></span></span><br><span class="line"><span class="function">3 <span class="title">bytes</span> <span class="title">payload</span></span></span><br><span class="line"><span class="function"><span class="title">keep</span> <span class="title">alive</span>: 1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">91.41% &lt;= 1 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.91% &lt;= 2 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.98% &lt;= 3 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">100.00% &lt;= 3 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">60569.35 <span class="title">requests</span> <span class="title">per</span> <span class="title">second</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">====== <span class="title">RPOP</span> ======</span></span><br><span class="line"><span class="function">100000 <span class="title">requests</span> <span class="title">completed</span> <span class="title">in</span> 1.71 <span class="title">seconds</span></span></span><br><span class="line"><span class="function">50 <span class="title">parallel</span> <span class="title">clients</span></span></span><br><span class="line"><span class="function">3 <span class="title">bytes</span> <span class="title">payload</span></span></span><br><span class="line"><span class="function"><span class="title">keep</span> <span class="title">alive</span>: 1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">87.03% &lt;= 1 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.75% &lt;= 2 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.98% &lt;= 3 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">100.00% &lt;= 3 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">58479.53 <span class="title">requests</span> <span class="title">per</span> <span class="title">second</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">====== <span class="title">SADD</span> ======</span></span><br><span class="line"><span class="function">100000 <span class="title">requests</span> <span class="title">completed</span> <span class="title">in</span> 1.91 <span class="title">seconds</span></span></span><br><span class="line"><span class="function">50 <span class="title">parallel</span> <span class="title">clients</span></span></span><br><span class="line"><span class="function">3 <span class="title">bytes</span> <span class="title">payload</span></span></span><br><span class="line"><span class="function"><span class="title">keep</span> <span class="title">alive</span>: 1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">78.23% &lt;= 1 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">98.87% &lt;= 2 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.82% &lt;= 3 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.97% &lt;= 4 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">100.00% &lt;= 4 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">52219.32 <span class="title">requests</span> <span class="title">per</span> <span class="title">second</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">====== <span class="title">SPOP</span> ======</span></span><br><span class="line"><span class="function">100000 <span class="title">requests</span> <span class="title">completed</span> <span class="title">in</span> 1.90 <span class="title">seconds</span></span></span><br><span class="line"><span class="function">50 <span class="title">parallel</span> <span class="title">clients</span></span></span><br><span class="line"><span class="function">3 <span class="title">bytes</span> <span class="title">payload</span></span></span><br><span class="line"><span class="function"><span class="title">keep</span> <span class="title">alive</span>: 1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">80.69% &lt;= 1 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.49% &lt;= 2 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.89% &lt;= 3 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.96% &lt;= 4 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.99% &lt;= 5 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">100.00% &lt;= 5 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">52631.58 <span class="title">requests</span> <span class="title">per</span> <span class="title">second</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">====== <span class="title">LPUSH</span> (<span class="title">needed</span> <span class="title">to</span> <span class="title">benchmark</span> <span class="title">LRANGE</span>) ======</span></span><br><span class="line"><span class="function">100000 <span class="title">requests</span> <span class="title">completed</span> <span class="title">in</span> 1.72 <span class="title">seconds</span></span></span><br><span class="line"><span class="function">50 <span class="title">parallel</span> <span class="title">clients</span></span></span><br><span class="line"><span class="function">3 <span class="title">bytes</span> <span class="title">payload</span></span></span><br><span class="line"><span class="function"><span class="title">keep</span> <span class="title">alive</span>: 1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">88.08% &lt;= 1 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.85% &lt;= 2 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.97% &lt;= 3 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">100.00% &lt;= 3 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">58207.21 <span class="title">requests</span> <span class="title">per</span> <span class="title">second</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">====== <span class="title">LRANGE_100</span> (<span class="title">first</span> 100 <span class="title">elements</span>) ======</span></span><br><span class="line"><span class="function">100000 <span class="title">requests</span> <span class="title">completed</span> <span class="title">in</span> 3.01 <span class="title">seconds</span></span></span><br><span class="line"><span class="function">50 <span class="title">parallel</span> <span class="title">clients</span></span></span><br><span class="line"><span class="function">3 <span class="title">bytes</span> <span class="title">payload</span></span></span><br><span class="line"><span class="function"><span class="title">keep</span> <span class="title">alive</span>: 1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">77.33% &lt;= 1 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.44% &lt;= 2 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">100.00% &lt;= 3 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">100.00% &lt;= 3 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">33200.53 <span class="title">requests</span> <span class="title">per</span> <span class="title">second</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">====== <span class="title">LRANGE_300</span> (<span class="title">first</span> 300 <span class="title">elements</span>) ======</span></span><br><span class="line"><span class="function">100000 <span class="title">requests</span> <span class="title">completed</span> <span class="title">in</span> 6.60 <span class="title">seconds</span></span></span><br><span class="line"><span class="function">50 <span class="title">parallel</span> <span class="title">clients</span></span></span><br><span class="line"><span class="function">3 <span class="title">bytes</span> <span class="title">payload</span></span></span><br><span class="line"><span class="function"><span class="title">keep</span> <span class="title">alive</span>: 1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">0.00% &lt;= 1 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">93.36% &lt;= 2 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.79% &lt;= 3 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.99% &lt;= 4 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">100.00% &lt;= 5 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">15142.34 <span class="title">requests</span> <span class="title">per</span> <span class="title">second</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">====== <span class="title">LRANGE_500</span> (<span class="title">first</span> 450 <span class="title">elements</span>) ======</span></span><br><span class="line"><span class="function">100000 <span class="title">requests</span> <span class="title">completed</span> <span class="title">in</span> 8.73 <span class="title">seconds</span></span></span><br><span class="line"><span class="function">50 <span class="title">parallel</span> <span class="title">clients</span></span></span><br><span class="line"><span class="function">3 <span class="title">bytes</span> <span class="title">payload</span></span></span><br><span class="line"><span class="function"><span class="title">keep</span> <span class="title">alive</span>: 1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">0.00% &lt;= 1 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">7.93% &lt;= 2 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.13% &lt;= 3 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.90% &lt;= 4 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.97% &lt;= 5 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.99% &lt;= 6 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.99% &lt;= 7 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">100.00% &lt;= 8 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">100.00% &lt;= 8 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">11458.69 <span class="title">requests</span> <span class="title">per</span> <span class="title">second</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">====== <span class="title">LRANGE_600</span> (<span class="title">first</span> 600 <span class="title">elements</span>) ======</span></span><br><span class="line"><span class="function">100000 <span class="title">requests</span> <span class="title">completed</span> <span class="title">in</span> 10.70 <span class="title">seconds</span></span></span><br><span class="line"><span class="function">50 <span class="title">parallel</span> <span class="title">clients</span></span></span><br><span class="line"><span class="function">3 <span class="title">bytes</span> <span class="title">payload</span></span></span><br><span class="line"><span class="function"><span class="title">keep</span> <span class="title">alive</span>: 1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">0.00% &lt;= 1 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">0.01% &lt;= 2 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">94.34% &lt;= 3 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.92% &lt;= 4 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.96% &lt;= 5 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.98% &lt;= 6 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.99% &lt;= 7 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">100.00% &lt;= 8 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">100.00% &lt;= 9 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">9344.05 <span class="title">requests</span> <span class="title">per</span> <span class="title">second</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">====== <span class="title">MSET</span> (10 <span class="title">keys</span>) ======</span></span><br><span class="line"><span class="function">100000 <span class="title">requests</span> <span class="title">completed</span> <span class="title">in</span> 1.77 <span class="title">seconds</span></span></span><br><span class="line"><span class="function">50 <span class="title">parallel</span> <span class="title">clients</span></span></span><br><span class="line"><span class="function">3 <span class="title">bytes</span> <span class="title">payload</span></span></span><br><span class="line"><span class="function"><span class="title">keep</span> <span class="title">alive</span>: 1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">85.43% &lt;= 1 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.74% &lt;= 2 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.93% &lt;= 3 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">99.97% &lt;= 4 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">100.00% &lt;= 5 <span class="title">milliseconds</span></span></span><br><span class="line"><span class="function">56529.11 <span class="title">requests</span> <span class="title">per</span> <span class="title">second</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">C</span>:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">Redis</span>&gt;</span></span><br></pre></td></tr></table></figure><br><br></details>

</li>
</ul>
</li>
</ul>
<h2 id="3장-NoSQL"><a href="#3장-NoSQL" class="headerlink" title="3장 NoSQL"></a>3장 NoSQL</h2><h3 id="NoSQL의-개념과-정의"><a href="#NoSQL의-개념과-정의" class="headerlink" title="NoSQL의 개념과 정의"></a>NoSQL의 개념과 정의</h3><ul>
<li>대용량 웹 서비스를 위하여 만들어진 데이터 저장소</li>
<li>관계형 데이터 모델을 지양하며 대량의 분산된 데이터를 저장하고 조회하는 데 특화된 저장소</li>
<li>스키마 없이 사용 가능하거나 느슨한 스키마를 제공하는 저장소</li>
</ul>
<p>구글의 빅에티블, 아마존의 다이나모와 같은 논문 및 자료는 데이터를 실시간으로 분산 처리하는 개념을 세상에 알려주었다. 시간이 지남에 따라 이 개념들을 토대로 실시간 분산 처리를 위한 오픈소스 솔루션들이 속속 개발되었고, 이와 같은 노력의 결과물이 NoSQL이다. </p>
<h3 id="CAP-정리"><a href="#CAP-정리" class="headerlink" title="CAP 정리"></a>CAP 정리</h3><p>CAP 정리란, 이론 컴퓨터 과학 분야에서 분산 컴퓨터 시스템을 설명하는 데 사용되는 이론이다. ‘일관성(Consistency), 가용성(Availability), 분할 허용성(Partition Tolerance) 모두를 동시에 지원하는 분산 컴퓨터 시스템은 없다’라고 정의되어 있다. </p>
<h4 id="일관성"><a href="#일관성" class="headerlink" title="일관성"></a>일관성</h4><p>일관성은 동시성 또는 동일성이라고도 하며 ‘다중 클라이언트에서 같은 시간에 조회하는 데이터는 항상 동일한 데이터임을 보증하는 것’을 의미한다. </p>
<h4 id="가용성"><a href="#가용성" class="headerlink" title="가용성"></a>가용성</h4><p>가용성이란 ‘모든 클라이너트의 읽기와 쓰기 요청에 대하여 항상 응답이 가능해야 함을 보증하는 것’이며 내고장성이라고도 한다. 시스템 아키텍처 설계에서 말하는 고가용성(High Availability)와 유사한 개념으로 볼 수 있다.<br>가용성을 설명하면서 빠지지 않는 단어가 단일 고장점 SPOF(Single Point Of Failure)이다. 단일 고장점이란 시스템을 구성하는 개별 요소 중에서 하나의 요소가 망가졌을 때 시스템 전체를 멈추게 만드는 요소를 말한다.</p>
<h4 id="네트워크-분할-허용성"><a href="#네트워크-분할-허용성" class="headerlink" title="네트워크 분할 허용성"></a>네트워크 분할 허용성</h4><p>지역적으로 분할된 네트워크 환경에서 동작하는 시스템에서 두 지역 간의 네트워크가 단절되거나 네트워크 데이터의 유실이 일어나더라도 각 지역 내의 시스템은 정상적으로 동작해야 함을 의미한다. </p>
<h3 id="NoSQL-분류와-저장구조"><a href="#NoSQL-분류와-저장구조" class="headerlink" title="NoSQL 분류와 저장구조"></a>NoSQL 분류와 저장구조</h3><p>저장소는 크게 키-값 모델, 문서 모델, 컬럼 모델, 그래프 모델로 분류할 수 있다. </p>
<h4 id="키-값-모델"><a href="#키-값-모델" class="headerlink" title="키-값 모델"></a>키-값 모델</h4><p>대부분의 키-값 모델 NoSQL은 단순한 저장구조로 인하여 복잡한 조회 연산을 지원하지 않는다. 또한 고속 읽기와 쓰기에 최적화된 경우가 많다.<br>레디스, 리악(Riak), 다이나모, 볼드모트 등이 있다. </p>
<h4 id="문서-모델"><a href="#문서-모델" class="headerlink" title="문서 모델"></a>문서 모델</h4><p>하나의 키에 하나의 구조화된 문서(JSON, BSON, XML 등)를 저장하고 조회한다.<br>키-값 및 컬럼모델 NoSQL에 비하여 상대적으로 많은 종류의 기능을 제공.<br>B트리의 특성으로 인하여 한 번 작성되면 자주 변하지 않는 정보를 저장하고 조회하는데 적합하다. 예를 들어 중앙 집중식 로그 저장, 타임라인 저장, 통계 정보 저장 등이 이에 해당된다.<br>MongoDB, 카우치베이스, 테라스토어, 레이븐DB 등이 있다. </p>
<h4 id="컬럼-모델"><a href="#컬럼-모델" class="headerlink" title="컬럼 모델"></a>컬럼 모델</h4><p>하나의 키에 여러 개의 컬럼 이름과 컬럼 값의 쌍으로 이루어진 데이터를 저장하고 조회한다. 단일 키에 의한 단일 컬럼 및 범위 조회도 가능하다. 모든 컬럼은 항상 타임스탬프 값과 함께 저장된다. 컬럼 모델 NoSQL에서 키는 로우키라 불린다.<br>HBase, 카산드라, 하이퍼 테이블 등이 있다. </p>
<h4 id="그래프-모델"><a href="#그래프-모델" class="headerlink" title="그래프 모델"></a>그래프 모델</h4><p>그래프모델 NoSQL은 노드와 관계(또는 버텍스와 엣지라고 한다)를 사용하여 데이터를 저장하고 조회하는데 관계는 속성이라는 부가 정보를 가진다. </p>
<h3 id="NoSQL을-언제-어떻게-사용해야-하는가"><a href="#NoSQL을-언제-어떻게-사용해야-하는가" class="headerlink" title="NoSQL을 언제 어떻게 사용해야 하는가?"></a>NoSQL을 언제 어떻게 사용해야 하는가?</h3><p>대량의 단순 정보를 빠르게 저장하고 조회할 때, 관계형 데이터베이스가 처리하지 못하는 대량의 데이터를 입력할 때(보통 수십 기가바이트의 데이터), 스키마가 고정되지 않은 데이터를 저장하고 조회할 때 등이 해당된다.<br>관계형 데이터베이스에서 NoSQL로 데이터 저장소를 변경할 때, 가장 먼저 고려해야 할 사항은 일관성 모델이다. 구현된 서비스에 강한 일관성 모델이 필요한지, 느슨한 일관성 모델을 사용해도 큰 문제가 되지 않는지에 대한 판단이 우선되어야 한다.<br>고려해야 할 사항들 : 일관성 모델, 데이터 모델, 읽기 쓰기 성능, 단일 고장점, 원자성 지원, 하드웨어 구성, 무중단 시스템</p>
<h2 id="4장-레디스-시작"><a href="#4장-레디스-시작" class="headerlink" title="4장 레디스 시작"></a>4장 레디스 시작</h2><h3 id="레디스-자료구조"><a href="#레디스-자료구조" class="headerlink" title="레디스 자료구조"></a>레디스 자료구조</h3><h4 id="문자열"><a href="#문자열" class="headerlink" title="문자열"></a>문자열</h4><p>저장 가능한 문자열의 크기는 최대 512MB이다. </p>
<h4 id="해시-데이터"><a href="#해시-데이터" class="headerlink" title="해시 데이터"></a>해시 데이터</h4><p>해시 데이터는 키 하나가 여러 개의 필드-값 쌍으로 이루어진다. 일반적인 프로그래밍 언어의 맵 자료구조와 동일하다. </p>
<h4 id="셋-데이터"><a href="#셋-데이터" class="headerlink" title="셋 데이터"></a>셋 데이터</h4><p>셋 데이터는 중복을 허용하지 않는 집합 형태의 자료구조이며, 정렬되어 있지 않다. 셋 데이터에는 2^32-1개의 값을 저장할 수 있다. 셋 데이터의 내부 구현은 해시 구조이기 때문에 저장된 요소의 개수에 상관없이 동일한 시간 복잡도를 가진다. </p>
<h4 id="정렬된-셋-데이터"><a href="#정렬된-셋-데이터" class="headerlink" title="정렬된 셋 데이터"></a>정렬된 셋 데이터</h4><p>셋 데이터와 유사한 구조를 가지고 있기 때문에 셋 데이터와 동일한 특징을 가지면서 요소 정렬이라는 부가적인 특징을 가진다. 정렬된 셋 데이터는 셋 데이터 구조에 요소의 가중치 값이 추가되어 있다. 가중치에 따라서 각 요소의 정렬이 수행되는데, 기본 정렬 순서는 오름차순이다. 정렬된 데이터 셋 구조는 셋 데이터와 동일하게 2^32-1개의 요소를 저장할 수 있으며, 가중치에 입력할 수 있는 값은 정수 똔느 배정밀도 부동소수점이다. 정렬된 셋 데이터는 주로 실시간 순위를 계산하는 데 사용된다. </p>
<h4 id="리스트-데이터"><a href="#리스트-데이터" class="headerlink" title="리스트 데이터"></a>리스트 데이터</h4><p>저장순서를 기억하는 데이터 구조로 중복을 허용한다. 저장 가능한 최대 요소 수는 2^32-1개이다. 레디스의 리스트 데이터는 이중 연결 리스트로 구현되어 있기 때문에 첫 번째 요소와 마지막 요소의 조회 시간이 가장 빠르며 리스트의 중간에 저장된 데이터를 조회하는 시간이 가장 오래 걸린다. </p>
<h3 id="주요-명령-예제"><a href="#주요-명령-예제" class="headerlink" title="주요 명령 예제"></a>주요 명령 예제</h3><h4 id="키-관리"><a href="#키-관리" class="headerlink" title="키 관리"></a>키 관리</h4><p>삭제, 만료, 목록 조회, 직렬화, 역 직렬화, 데이터형 조회, 키 이동 등이 있다. </p>
<h4 id="키의-만료"><a href="#키의-만료" class="headerlink" title="키의 만료"></a>키의 만료</h4><p>저장된 키에 대하여 만료시간을 설정할 수 있다(레디스가 멤캐시드와 같은 캐시 시스템과 비교되는 이유가 바로 이 기능 때문이다). 키의 만료란 지정된 시간이 되면 키와 키에 저장된 데이터가 사라지게 되어 조회할 수 없는 상태로 변하는 것을 말하는데, 레디스가 제공하는 만료 처리 방법은 ‘지정된 시간에 만료’와 명령이 수행된 이후부터 일정 시간 이후의 만료’를 지원한다. </p>
<h2 id="5장-레디스-클라이언트"><a href="#5장-레디스-클라이언트" class="headerlink" title="5장 레디스 클라이언트"></a>5장 레디스 클라이언트</h2><h3 id="자바-클라이언트"><a href="#자바-클라이언트" class="headerlink" title="자바 클라이언트"></a>자바 클라이언트</h3><ul>
<li>Jedis</li>
<li>JRedis</li>
<li>JDBC-Redis</li>
<li>RJC</li>
<li>rdis-protocol</li>
<li>lettuce</li>
</ul>
<h4 id="예제-5-1-Hello-Jedis"><a href="#예제-5-1-Hello-Jedis" class="headerlink" title="예제 5-1 Hello Jedis"></a>예제 5-1 Hello Jedis</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.sf.redisbook.ch5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * first Jedis sample</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloJedis</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * main function</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> args none</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// connect to redis server running on 192.168.56.102</span></span><br><span class="line">		Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"192.168.56.102"</span>, <span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// set data to key redisbook</span></span><br><span class="line">		String result = jedis.set(<span class="string">"redisbook"</span>, <span class="string">"hello redis!"</span>);</span><br><span class="line">		System.out.println(result);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// get data from key redisbook</span></span><br><span class="line">		System.out.println(jedis.get(<span class="string">"redisbook"</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>예제 5-1은 매번 실행될 때마다 새로운 레디스 연결을 생성한다. 이와같이 데이터의 요청마다 새로운 커넥션을 만들 수도 있지만 서버 관점에서는 좋지 않은 사용 패턴이다. 한 번 생성된 커넥션은 재사용하는 것이 리소스 관리 측면에서 유리하다. 제디스는 이와 같은 커넥션 재사용을 위한 JedisPool 이라는 연결 풀 객체를 제공한다. 제디스의 연결 풀을 사용한 [예제5-2]를 살펴보자. [예제5-2]는 연결 풀을 사용하여 해시 데이터에 사용자의 정보를 저장하고 조회한다. </p>
<h4 id="예제-5-2-제디스-연결-풀-사용예제"><a href="#예제-5-2-제디스-연결-풀-사용예제" class="headerlink" title="예제 5-2 제디스 연결 풀 사용예제"></a>예제 5-2 제디스 연결 풀 사용예제</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.sf.redisbook.ch5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.pool.impl.GenericObjectPool;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.pool.impl.GenericObjectPool.Config;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * connect to redis using jedis pool sample</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisPoolTest</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * main function</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> args none</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Config config = <span class="keyword">new</span> Config();</span><br><span class="line">		config.maxActive = <span class="number">20</span>;</span><br><span class="line">		config.whenExhaustedAction = GenericObjectPool.WHEN_EXHAUSTED_BLOCK;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// create jedis pool for redis server running on 192.168.56.102</span></span><br><span class="line">		JedisPool pool = <span class="keyword">new</span> JedisPool(config, <span class="string">"192.168.56.102"</span>, <span class="number">6379</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// get the first jedis connection from jedis pool</span></span><br><span class="line">		Jedis firstClient = pool.getResource();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// set data to redis using hset command</span></span><br><span class="line">		firstClient.hset(<span class="string">"info:자린고비"</span>, <span class="string">"이름"</span>, <span class="string">"자린고비"</span>);</span><br><span class="line">		firstClient.hset(<span class="string">"info:자린고비"</span>, <span class="string">"생일"</span>, <span class="string">"1970-12-20"</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// get the seconds jedis connection from jedis pool</span></span><br><span class="line">		Jedis secondClient = pool.getResource();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// get date from redis using hgetall command, result is a map object</span></span><br><span class="line">		Map&lt;String, String&gt; result = secondClient.hgetAll(<span class="string">"info:자린고비"</span>);</span><br><span class="line">		System.out.println(<span class="string">"이름 : "</span> + result.get(<span class="string">"이름"</span>));</span><br><span class="line">		System.out.println(<span class="string">"생일 : "</span> + result.get(<span class="string">"생일"</span>));</span><br><span class="line"></span><br><span class="line">		<span class="comment">// return jedis first connection to jedis pool</span></span><br><span class="line">		pool.returnResource(firstClient);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// return jedis first connection to jedis pool</span></span><br><span class="line">		pool.returnResource(secondClient);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// destory the jedis pool</span></span><br><span class="line">		pool.destroy();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>제디스는 아파치의 ObjectPool 라이브러리를 사용하여 연결 풀을 제공한다. </p>
<ol>
<li>ObjectPool의 최대 개수를 설정한다. </li>
<li>ObjectPool에 등록된 연결이 설정한 최대 개수에 도달했을 때, 새로운 요청에 대한 처리 방법을 지정한다. 여기서는 가용 연결이 생길 때까지 대기하도록 설정했다. </li>
<li><ol>
<li>의 설정값을 기초로 하여 IP 192.168.56.102의 6379포트에서 동작하는 레디스 서버의 제디스 연결풀을 생성한다. </li>
</ol>
</li>
<li>생성된 제디스 풀에서 첫 번째 커넥션을 가져온다.</li>
<li>첫 번째 커넥션을 사용하여 info:자린고비 키에 hset 메서드를 사용하여 자린고비 사용자의 정보를 입력한다. </li>
<li>생성된 제디스 풀에서 두 번째 커넥션을 가져온다. </li>
<li>info: 자린고비 키에 저장된 정보를 hmget 메서드를 사용하여 조회한다.</li>
<li>첫 번째 커넥션을 풀로 돌려준다. </li>
<li>두 번째 커넥션을 풀로 돌려준다. </li>
<li>생성된 제디스 연결 풀을 제거한다. </li>
</ol>
<p>[예제5-2]는 단일 자바 애플리케이션이므로 연결 풀을 제거하는 10. 을 수행했다. 통상적으로 WAS에서 위와 같은 프로그램을 만든다면 연결 풀을 전역상수(static final 상수)에 등록하여 사용한다.<br>레디스 명령행 클라이언트는 영문이 아닌 키와 인코딩된 데이터를 출력하지만 제디스는 인코딩되지 않은 데이터를 출력한다. </p>
<h4 id="예제-5-10-제디스를-사용한-입력"><a href="#예제-5-10-제디스를-사용한-입력" class="headerlink" title="예제 5-10 제디스를 사용한 입력"></a>예제 5-10 제디스를 사용한 입력</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.sf.redisbook.ch5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisInsertTest</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> TOTAL_OP = <span class="number">1000000f</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</span><br><span class="line">		JedisPool pool = <span class="keyword">new</span> JedisPool(<span class="string">"192.168.56.102"</span>, <span class="number">6379</span>);</span><br><span class="line">		Jedis jedis = pool.getResource();</span><br><span class="line">		String key, value;</span><br><span class="line">		<span class="keyword">long</span> start = now();</span><br><span class="line">		<span class="keyword">long</span> loopTime = now();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= TOTAL_OP; i++) &#123;</span><br><span class="line">			key = value = String.valueOf(<span class="string">"key"</span> + (<span class="number">100000000</span> + i));</span><br><span class="line">			jedis.set(key, value);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">long</span> elapsed = now() - start;</span><br><span class="line">		System.out.println(<span class="string">"초당 처리건수 "</span> + TOTAL_OP / elapsed * <span class="number">1000f</span>);</span><br><span class="line">		System.out.println(<span class="string">"소요시간 "</span> + elapsed / <span class="number">1000f</span> + <span class="string">"초"</span>);</span><br><span class="line">		jedis.disconnect();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">now</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> System.currentTimeMillis();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1.에서는 입력을 위한 전체 데이터 건수를 지정했다. 2.는 레디스에 저장할 키와 값을 12자리로 고정하기 위한 코드다. [예제 5-10]에서 생성된 키의 범위는 key100000001부터 key109999999까지 전부 천만 개고 필자의 테스트 장비에서 실행했다. </p>
<p>예제 5-10이 실행된 결과는 아래와 같다.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">초당 처리 건수 7803.965</span><br><span class="line">소요 시간 1281.4초</span><br></pre></td></tr></table></figure></p>
<h4 id="예제-5-11-천만-건의-데이터를-다중-스레드로-전송하는-예제"><a href="#예제-5-11-천만-건의-데이터를-다중-스레드로-전송하는-예제" class="headerlink" title="예제 5-11 천만 건의 데이터를 다중 스레드로 전송하는 예제"></a>예제 5-11 천만 건의 데이터를 다중 스레드로 전송하는 예제</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.sf.redisbook.ch5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.pool.impl.GenericObjectPool;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.pool.impl.GenericObjectPool.Config;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisThreadTest</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> TOTAL_OP = <span class="number">10000000f</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> THREAD = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Config config = <span class="keyword">new</span> Config();</span><br><span class="line">		config.maxActive = <span class="number">500</span>;</span><br><span class="line">		config.whenExhaustedAction = GenericObjectPool.WHEN_EXHAUSTED_BLOCK;</span><br><span class="line">		<span class="keyword">final</span> JedisPool pool = <span class="keyword">new</span> JedisPool(config, <span class="string">"192.168.56.102"</span>, <span class="number">6379</span>, <span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">final</span> <span class="keyword">long</span> start = now();</span><br><span class="line">		Runtime.getRuntime().addShutdownHook(<span class="keyword">new</span> Thread() &#123;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				<span class="keyword">long</span> elapsed = now() - start;</span><br><span class="line"></span><br><span class="line">				System.out.println(<span class="string">"스레드 개수 "</span> + THREAD + <span class="string">"개"</span>);</span><br><span class="line">				System.out.println(<span class="string">"초당 처리 건수 "</span> + TOTAL_OP / elapsed * <span class="number">1000f</span>);</span><br><span class="line">				System.out.println(<span class="string">"소요 시간 "</span> + elapsed / <span class="number">1000f</span> + <span class="string">"초"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">		JedisThreadTest test = <span class="keyword">new</span> JedisThreadTest();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; THREAD; i++) &#123;</span><br><span class="line">			test.makeWorker(pool, i).start();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> Thread <span class="title">makeWorker</span><span class="params">(<span class="keyword">final</span> JedisPool pool, <span class="keyword">final</span> <span class="keyword">int</span> idx)</span> </span>&#123;</span><br><span class="line">		Thread thread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				String key, value;</span><br><span class="line">				Jedis jedis = pool.getResource();</span><br><span class="line"></span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= TOTAL_OP; i++) &#123;</span><br><span class="line">					<span class="keyword">if</span> (i % THREAD == idx) &#123;</span><br><span class="line">						key = value = String.valueOf(<span class="string">"key-test"</span> + (<span class="number">100000000</span> + i));</span><br><span class="line">						jedis.set(key, value);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				pool.returnResource(jedis);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> thread;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">long</span> <span class="title">now</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> System.currentTimeMillis();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>[예제 5-11]은 [예제 5-10]을 다중 스레드로 구현했다. 1.에 설정된 스레드의 개수를 조절하면서 테스트해보자. </p>
<ol>
<li>프로그램 실행 시 시작할 스레드 개수를 지정한다. 예제에서는 5로 지정했다. </li>
<li>자바 프로그램이 종료될 때 실행되는 이벤트 스레드를 등록한다. </li>
<li>전체 실행 시간과 초당 전송 수를 출력한다. </li>
<li>지정된 스레드 개수만큼 스레드를 생성한다. 생성하는 스레드에 연결 풀과 인덱스를 인자로 지정한다. </li>
<li>실제 데이터를 전송할 스레드를 생성한다. </li>
<li>지정된 스레드 인덱스에 해당하는 키를 생성하고 아니면 실행하지 않는다. 이 부분은 각 스레드가 천만개의 요청을 공평하게 나누어 전송하게 한다. </li>
</ol>
<p>아래는 [예제 5-11]에서 5개의 스레드를 설정하고 실행한 결과다.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">스레드 개수 5개</span><br><span class="line">초당 처리 건수 12174.04</span><br><span class="line">소요 시간 821.41초</span><br></pre></td></tr></table></figure></p>
<p>단일 스레드에 비해 성능이 약 60% 정도 향상됐다.<br>…<br>스레드의 개수가 증가하면서 성능이 지속적으로 증가하다가 100개를 정점으로 성능이 하락한다. 즉, 다중 스레드에 대한 임계치가 존재한다. </p>
<h3 id="레디스-파이프라인"><a href="#레디스-파이프라인" class="headerlink" title="레디스 파이프라인"></a>레디스 파이프라인</h3><p>불필요한 네트워크 왕복 시간을 줄여 더 빠른 성능을 얻고자 한다면 레디스 파이프라인을 사용하자. 파이프라인은 레디스 명령행 클라이언트와 제디스 모두에서 실행 가능하다. </p>
<p>레디스 명령행 클라이언트에서 파이트라인을 사용하려면 데이터가 저장된 파일이 필요하다. 이 텍스트 파일은 두 가지 구조를 가질 수 있다. 첫 번째는 순수한 레디스 명령 집합으로 이루어진 텍스트 파일이고, 두 번째는 5.2절에서 설명한 레디스 프로토콜로 이루어진 텍스트 파일이다. </p>
<p>파이프라인을 운영 중인 시스템에 사용하면 파이프라인 명령이 레디스의 모든 리소스를 점유하게 되어 서비스의 응답 속도가 저하되기도 한다. 이럴 때는 제디스와 같은 클라이언트 라이브러리를 사용하여 데이터를 입력하는 편이 더 낫다. </p>
<h2 id="6장-레디스-내부구조"><a href="#6장-레디스-내부구조" class="headerlink" title="6장 레디스 내부구조"></a>6장 레디스 내부구조</h2><h3 id="레디스-객체-구조"><a href="#레디스-객체-구조" class="headerlink" title="레디스 객체 구조"></a>레디스 객체 구조</h3><p>레디스는 저장된 데이터를 관리하기 위하여 redisObject 객체를 사용한다. </p>
<h3 id="레디스-인코딩-종류"><a href="#레디스-인코딩-종류" class="headerlink" title="레디스 인코딩 종류"></a>레디스 인코딩 종류</h3><p>레디스는 데이터의 주 저장소로 메모리를 사용한다. 운영체제의 관점에서 메모리는 한정적인 자원이며 매우 비싼 리소스에 해당한다. 레디스의 개발자는 이와 같이 제한적인 환경에서 데이터를 효율적으로 저장하기 위해서 인코딩을 사용한다. 레디스에서 사용하는 인코딩의 종류는 앞에서 설명한 바와 같이 모두 8가지이다. </p>
<h4 id="문자열-데이터-인코딩"><a href="#문자열-데이터-인코딩" class="headerlink" title="문자열 데이터 인코딩"></a>문자열 데이터 인코딩</h4><ul>
<li>REDIS_ENCODING_RAW : 전혀 가공되지 않은 원본 데이터  </li>
<li>REDIS_ENCODING_INT : 숫자 데이터 인코딩<br>레디스는 10000보다 작은 숫자를 미리 공유객체 상수로 등록해 두어 같은 객체를 재사용한다. 이렇게 하면 동일한 값을 가지는 데이터를 한 번만 저장하므로 메모리 낭비를 막을 수 있다. <h4 id="리스트-데이터-인코딩"><a href="#리스트-데이터-인코딩" class="headerlink" title="리스트 데이터 인코딩"></a>리스트 데이터 인코딩</h4></li>
<li>REDIS_ENCODING_ZIPLIST : 리스트 데이터를 저장할 때 더 적은 메모리를 사용할 수 있음. 더 많은 CPU를 사용</li>
<li>REDIS_ENCODING_LINKEDLIST : 일반 연결 리스트의 구조와 동일<h4 id="셋-데이터-인코딩"><a href="#셋-데이터-인코딩" class="headerlink" title="셋 데이터 인코딩"></a>셋 데이터 인코딩</h4>셋 데이터는 O(1)의 시간 복잡도를 제공하기 위하여 내부적으로 해시 테이블 구조로 구현되어 있다. </li>
<li>REDIS_ENCODING_INTSET : 메모리를 절약하기 위한 특별한 인코딩</li>
<li>REDIS_ENCODING_HT : 셋 데이터의 기본 인코딩</li>
</ul>
<h3 id="레디스-문자열"><a href="#레디스-문자열" class="headerlink" title="레디스 문자열"></a>레디스 문자열</h3><p>레디스는 문자열을 메모리에 저장할 때 C언어의 char*를 사용하여 저장한다. 전체 메모리의 크기를 확인할 필요 없이 sdshdr 구조체의 len 필드를 조회하여 문자열의 길이를 확인할 수 있다. </p>
<h4 id="예제-6-10-문자열-표현을-위한-SDS-구조체"><a href="#예제-6-10-문자열-표현을-위한-SDS-구조체" class="headerlink" title="예제 6-10 문자열 표현을 위한 SDS 구조체"></a>예제 6-10 문자열 표현을 위한 SDS 구조체</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span>  <span class="title">sdshdr</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> len;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">free</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="레디스-공유-객체"><a href="#레디스-공유-객체" class="headerlink" title="레디스 공유 객체"></a>레디스 공유 객체</h3><p>레디스는 자주 사용되는 값을 전역 변수인 공유 객체에 저장해 두고 사용한다. 이 공유객체에 포함되는 값의 종류는 에러 메시지, 프로토콜을 위한 문자열, 자주 사용되는 문자열, 0부터 9999까지의 숫자가 해당된다. 특이하게도 이 모든 값은 redisObject 구조체를 사용하여 표현된다. </p>
<h2 id="7장-레디스-활용-사례"><a href="#7장-레디스-활용-사례" class="headerlink" title="7장 레디스 활용 사례"></a>7장 레디스 활용 사례</h2><ul>
<li>레디스로 구현할 수 있는 것</li>
<li>레디스 활용 사례와 구현</li>
<li>구현의 문제점과 해결책</li>
<li>사례의 기능 확장</li>
<li>기능 테스트</li>
</ul>
<h2 id="8장-확장과-분산-기법"><a href="#8장-확장과-분산-기법" class="headerlink" title="8장 확장과 분산 기법"></a>8장 확장과 분산 기법</h2><p>레디스에 스케일 아웃을 적용하기 위해서 동일한 사양의 하드웨어를 3대로 늘리는 방법을 생각해보자. 레드스는 스케일 아웃을 처리하기 위한 방법으로 두 가지 기법을 제공한다. 읽기 분산을 위한 복제(Replication)와 쓰기 분산을 위한 샤딩(Sharding)이 이에 해당된다. </p>
<p>레디스 클러스터에 포함되는 설명에서는 노드로 표현하며 클러스터가 아닌 별도의 단일 서버에 대한 설명에서는 레디스 인스턴스로 표현한다. </p>
<ul>
<li>복제 : 클라이언트가 어느 노드에 접근하더라도 동일한 데이터를 읽을 수 있도록 데이터를 각 노드에 복제하여 저장하는 것을 말한다.</li>
<li>샤딩 : 데이터를 특정 조건에 따라 나누어 저장하는 것을 말한다. 예를 들어 1부터 10까지 10개의 데이터를 두 대의 노드를 사용하여 샤딩을 수행한다고 가정하자. 이 때 첫 번쨰 노드에 1부터 5까지의 데이터를 저장하고 두 번째 노드에 6부터 10까지의 데이터를 저장하여 데이터를 분할 저장하는 방법을 샤딩이라 말한다. </li>
<li>샤드(shard) : 두 개의 노드를 사용하여 데이터를 분할 저장하였을 때 각 노드를 샤드라고 부른다. 각 샤드가 복제를 사용하여 여러 개의 노드로 구성될 때에도 하나의 샤드로 취급한다. </li>
</ul>
<h3 id="읽기-성능-증대를-위한-복제-기법"><a href="#읽기-성능-증대를-위한-복제-기법" class="headerlink" title="읽기 성능 증대를 위한 복제 기법"></a>읽기 성능 증대를 위한 복제 기법</h3><p>복제는 동일한 데이터를 다중의 노드에 중복하여 저장하는 것을 말하는데, 레디스는 복제를 위해서 마스터와 슬레이브의 복제의 개념을 사용한다. 마스터는 복제를 위한 데이터의 원본 역할을 한다. 슬레이브는 마스터 노드에 데이터 복제 요청을 하고 데이터를 수신하여 데이터를 동기화한다. </p>
<p>레디스의 복제는 읽기 성능의 증대를 위해서 사용된다. 통상적으로 레디스 인스턴스 하나가 처리할 수 있는 TPS(Transaction Per Second)는 1만에서 2만이다. 또한 대부분의 레디스 명령은 읽기와 쓰기에 따른 성능 편차가 없다. 그러므로 레디스의 읽기 성능을 증대시키기 위해서 복제를 사용해여 클러스터를 구성한다. </p>
<p>레디스의 복제는 기본적으로 마스터 노드에서 쓰기 연산을 수행하고 슬레이브 노드에서 읽기 연산을 수행하도록 하여 읽기와 쓰기를 완전히 분리한다. 읽기 연산과 쓰기 연산을 완전히 분리하여 확장 구조의 유연성을 가질 수 있다. 반대로 읽기와 쓰기를 분리하기 위해서 애플리케이션 레벨에서 사용할 수 있는 명령의 한계와 애플리케이션의 복잡도 증가가 발생하게 된다. </p>
<p>복제는 슬레이브 노드가 마스터 노드의 데이터를 실시간으로 복제하여 데이터의 동기화를 유지한다. 슬레이브 노드가 시작할 때 마스터 노드에게 복제를 요청하고 최초 복제가 완료된 이후는 변경 사항만 업데이트한다. 슬레이브 노드가 복제를 요청하므로 마스터 노드의 위치 정보는 슬레이브 노드가 가지고 있다. 그러므로 레디스 클러스터에 노드를 추가할 때 마스터 노드의 설정 변경이나 마스터 노드의 재시작 등이 필요하지 않다. </p>
<p>이와 같이 레디스의 복제는 마스터 노드가 슬레이브의 정보를 가지지 않기 때문에 다양한 구조의 복제 구성이 가능하다. </p>
<h4 id="단일-복제"><a href="#단일-복제" class="headerlink" title="단일 복제"></a>단일 복제</h4><h4 id="예제-8-1-마스터-노드를-위한-레디스-설정-파일"><a href="#예제-8-1-마스터-노드를-위한-레디스-설정-파일" class="headerlink" title="예제 8-1 마스터 노드를 위한 레디스 설정 파일"></a>예제 8-1 마스터 노드를 위한 레디스 설정 파일</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> redis configration</span></span><br><span class="line">port 6300</span><br><span class="line">dbfilename 6300.rdb</span><br></pre></td></tr></table></figure>
<h4 id="예제-8-2-슬레이브-노드를-위한-레디스-설정-파일-slave-conf"><a href="#예제-8-2-슬레이브-노드를-위한-레디스-설정-파일-slave-conf" class="headerlink" title="예제 8-2 슬레이브 노드를 위한 레디스 설정 파일 -slave.conf"></a>예제 8-2 슬레이브 노드를 위한 레디스 설정 파일 -slave.conf</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> redis configration</span></span><br><span class="line">port 6301</span><br><span class="line">dbfilename 6301.rdb</span><br><span class="line">slaveof 192.168.56.102 6300</span><br><span class="line">slave-read-only no</span><br></pre></td></tr></table></figure>
<p>1.은 마스터 노드의 위치 정보를 나타내는데 슬레이브 노드의 설정 파일에 마스터 노드의 위치 정보가 포함된다. 2.는 레디스 2.6에서 추가된 새로운 기능으로서 슬레이브 노드의 동작 방식을 결정한다. 단순 읽기 전용으로 사용할 것인지 읽기와 쓰기를 모두 허용할 것인지를 결정한다. </p>
<h4 id="다중-복제"><a href="#다중-복제" class="headerlink" title="다중 복제"></a>다중 복제</h4><p>단일 복제 상태에서 여러 대의 슬레이브 노드를 추가한 것을 다중 복제라고 한다. 새로운 슬레이브 노드를 추가하는 방법은 단일 복제에서 첫 번째 슬레이브 노드를 추가하는 방법과 완전히 동일하다. </p>
<p>마스터 노드에서 데이터를 슬레이브 노드로 복제하기 위해서 필요한 리소스는 마스터 노드의 CPU와 네트워크다. 그중에서도 네트워크 리소스의 비용이 가장 크다. 하나의 마스터 노드에 너무 많은 슬레이브 노드가 접속되면 마스터 노드가 가진 대부분의 리소스가 복제를 위한 데이터 동기화에 사용되어 전체적인 성능이 저하된다. </p>
<h4 id="계층형-복제"><a href="#계층형-복제" class="headerlink" title="계층형 복제"></a>계층형 복제</h4><p>계층형 복제는 마스터 노드에 너무 많은 슬레이브가 접속되어 쓰기 성능이 저하되는 문제점을 해결하기 위한 복제 방법이다.<br>마스터 노드와 슬레이브 노드 1이 1차로 복제되어 동기화되고, 그 이후에 슬레이브 노드 2,3,4가 복제된다. 슬레이브 노드 1은 1차 복제를 수행하기 위해서 읽기와 쓰기 연산을 수행하지 않도록 구성되어 있다. 다중 복제에서 설명한 리소스 부족이 그 이유인데, 리소스가 충분하다면 슬레이브 1에서 읽기 연산을 수행하여도 무방하다. </p>
<p>레디스의 클러스터 구성에서는 듀얼 마스터(Dual Master) 또는 다중 마스터(Multi Master) 복제를 지원하지 않는다. </p>
<h3 id="쓰기-성능-증대를-위한-샤딩-기법"><a href="#쓰기-성능-증대를-위한-샤딩-기법" class="headerlink" title="쓰기 성능 증대를 위한 샤딩 기법"></a>쓰기 성능 증대를 위한 샤딩 기법</h3><p>샤딩은 다른 용어로 파티셔닝(Partitioning)이라 부른다. 데이터 파티셔닝은 두 가지 관점에서 유용하다. 첫째, 더 많은 데이터를 레디스에 저장할 수 있다. 예를 들어 복제를 사용했을 때 레디스에 저장 가능한 데이터의 전체 크기는 마스터 노드의 메모리 크기와 동일하거나 더 작다. 즉, 마스터 노드의 물리 메모리 크기보다 많은 데이터를 저장하면 성능이 급격하게 저하되기 때문에 마스터 노드의 메모리 크기에 의해서 저장 가능한 전체 데이터 크기가 결정된다. 그러므로 샤딩은 동일한 개수의 하드웨어를 사용할 떄 복제에 비해서 더 많은 데이터를 저장할 수 있다. </p>
<p>샤딩을 통해서 쓰기 성능의 증대를 이룰 수 있다. 하나의 물리적인 하드웨어가 처리할 수 있는트랜잭션 수를 100이라고 했을 때 다중의 하드웨어에 복제를 수행하여 쓰기 성능을 증대 하려는 시도를 생각해보자. 마스터 하드웨어에 쓰기 연산이 발생하면 나머지 두 하드웨어에도 동일한 쓰기 연산이 발생해야 동기화가 유지된다. 즉 모든 노드가 동일한 쓰기 연산을 수행하게 되므로 복제를 통해서는 쓰기 성능을 증대시킬 수 없다. 반대로 샤딩을 사용하면 하나의 샤드에 하나의 데이터만 존재하므로 쓰기 연산은 해당 샤드에서만 발생하여 더 많은 쓰기 연산을 처리할 수 있다. </p>
<p>레디스 2.6버전에서는 서버 측 샤딩을 지원하지 않으므로 클라이언트 측 샤딩을 사용하여야 한다. </p>
<ul>
<li>수직 샤딩(Vertical Sharding) : 관계형 데이터베이스의 테이블에 해당하는 정보를 노드별로 분할하는 방법이다. 예를 들어 사용자 정보는 첫 번째 노드, 친구 정보는 두 번째 노드에 저장하는 방식을 말한다. </li>
<li>범위 지정 샤딩(Range Sharding) : 키를 특정 범위를 기준으로 분할하여 저장하는 방법이다. 예를 들어 1부터 1,000까지의 키가 있을 때 1부터 500까지의 키는 첫 번째 노드, 501부터 1,000까지의 키는 두 번째 노드에 저장하게 된다. </li>
<li>해시 기반 샤딩(Hash Based Sharding) : 키를 해시 함수에 대입하여 결과값에 특정 연산을 가해 데이터의 위치를 결정하는 방법을 말하는데, 일관된 해싱(Consistent Hashing)이라고도 한다. </li>
</ul>
<h3 id="마치며"><a href="#마치며" class="headerlink" title="마치며"></a>마치며</h3><p>레디스 클러스터 버전이 나오지 않았기 때문에 클러스터의 정보를 클라이언트에서 가지고 있어야 하는 문제가 남아있다. 이와 같은 문제점을 해결하기 위하여 클러스터의 정보를 원격 서버에 저장하고 클라이언트에서 원격 서버로부터 클러스터 정보를 업데이트하도록 구성하기도 한다. </p>
<p>레디스의 샤딩 구성에서 가장 중요한 부분은 해시 함수의 선택이다. 데이터의 저장 위치는 해시 함수의 결과에 따라서 정해지기 때문에 운영 중간에 해시 함수의 변경으로 전체 데이터의 위치를 다시 정해야 하는 상황이 발생할 수 있다는 것이다. </p>
<h2 id="9장-레디스-운영-시-고려사항"><a href="#9장-레디스-운영-시-고려사항" class="headerlink" title="9장 레디스 운영 시 고려사항"></a>9장 레디스 운영 시 고려사항</h2><h3 id="임계점의-정의"><a href="#임계점의-정의" class="headerlink" title="임계점의 정의"></a>임계점의 정의</h3><p>논리적으로 스케일 아웃의 한계는 없다. 하지만 현실적으로 네트워크 대역폭 등의 의한 한계가 있다. </p>
<h3 id="CPU-메모리-네트워크에-대한-임계점"><a href="#CPU-메모리-네트워크에-대한-임계점" class="headerlink" title="CPU, 메모리, 네트워크에 대한 임계점"></a>CPU, 메모리, 네트워크에 대한 임계점</h3><p>레디스는 데이터 저장과 조회에 단일 스레드를 사용한다. 바꾸어 말하면 멀티코어 시스템에서 실행되더라도 하나의 코어를 사용하기 때문에 단일 코어의 성능이 낮은 32코어 장치보다 단일 코어 성능이 높은 4코어 장치에서 더 빠른 성능을 보인다. </p>
<p>레디스는 메모리에 데이터를 저장하기 때문에 레디스가 사용할 메모리의 크기를 지정하는 것은 성능과 가장 밀접한 관련이 있다. </p>
<p>복제를 위한 데이터는 모두 네트워크 허브 2를 통하여 전송되고, 데이터의 읽기 연산과 쓰기 연산은 모두 네트워크 허브 1을 사용하여 전송된다. 즉, 이와 같이 네트워크를 구성하면 서비스를 위한 네트워크 대역폭을 분리하여 네트워크 병목 현상을 피할 수 있다. </p>
<h3 id="임계점-테스트-벤치마크"><a href="#임계점-테스트-벤치마크" class="headerlink" title="임계점 테스트 벤치마크"></a>임계점 테스트 벤치마크</h3><h3 id="임계점의-한계를-극복하기-위한-하드웨어-구성"><a href="#임계점의-한계를-극복하기-위한-하드웨어-구성" class="headerlink" title="임계점의 한계를 극복하기 위한 하드웨어 구성"></a>임계점의 한계를 극복하기 위한 하드웨어 구성</h3><p>레디스의 복제를 구성할 때 하나의 마스터에 너무 많은 슬레이브를 구성하지 않도록 한다. 이와 같은 상황을 방지하기 위해서 복제를 위한 별도의 네트워크 카드를 설정하는 방법과 복제를 위한 별도의 스위치 허브를 사용하는 구성을 고려해야 한다. </p>
<p>레디스 클러스터 구성에서 가장 쉽게 만날 수 있는 임계점은 네트워크다. 레디스 클러스터 구성에서 네트워크 임계점에 도달하게 되면 클라이언트로 전송되는 명령의 응답시간이 늘어나게 되므로 빠른 응답시간이 필요한 서비스에서는 치명적인 단점이 된다는 사실을 잊지 말자. </p>
<h2 id="10장-레디스-튜닝"><a href="#10장-레디스-튜닝" class="headerlink" title="10장 레디스 튜닝"></a>10장 레디스 튜닝</h2><h3 id="레디스의-환경-설정-redis-config"><a href="#레디스의-환경-설정-redis-config" class="headerlink" title="레디스의 환경 설정 - redis.config"></a>레디스의 환경 설정 - redis.config</h3><h3 id="레디스의-스냅샷-RDB"><a href="#레디스의-스냅샷-RDB" class="headerlink" title="레디스의 스냅샷 - RDB"></a>레디스의 스냅샷 - RDB</h3><p>레디스는 데이터의 영구 저장을 위하여 메모리에 저장된 모든 데이터를 디스크로 저장하며 이것을 스냅샷이라고 부른다. 스냅샷이라고 불리는 이유는 특정 시점의 메모리를 사진을 찍듯이 그대로 디스크에 저장하기 때문이다. 스냅샷의 결과로 dump.rdb 파일이 생성되는데 이 파일을 사용하여 해당 시점의 데이터로 복원할 수 있다. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">전체 메모리 = 자식 프로세스의 메모리 크기 + 부모 프로세스가 변경한 페이지 개수 * 4KB</span><br></pre></td></tr></table></figure>
<p>fork 함수가 호출되어 자식 프로세스가 종료되기 전에 모든 페이지가 변경된다면 레디스는 메모리를 최대 2배만큼 사용하게 된다. 이와 같은 상황은 쓰기 연산이 매우 많은 시스템에서 발생할 수 있다. 그러므로 스냅샷을 사용할 때는 자신의 서비스가 쓰기 위즈의 서비스인지를 먼저 확인하여 메모리 사용 정책을 정의해야 한다. </p>
<h3 id="Append-Only-File-AOF"><a href="#Append-Only-File-AOF" class="headerlink" title="Append Only File - AOF"></a>Append Only File - AOF</h3><p>AOF(Append Only File)는 레디스에서 데이터의 영구 저장을 위하여 지원하는 두 번째 기능이다. 레디스가 수신하는 모든 쓰기 명령을 aof 파일에 기록하여 데이터를 보관한다.<br>AOF는 스냅샷에 비해 더 나은 데이터 정합성을 보장한다. 즉, 스냅샷은 각 스냅샷 사이의 데이터를 잃어버리지만 AOF는 최악의 상황에서 마지막 1초의 데이터만을 잃어버린다. </p>
<h3 id="각-설정에-따른-장단점"><a href="#각-설정에-따른-장단점" class="headerlink" title="각 설정에 따른 장단점"></a>각 설정에 따른 장단점</h3><p>aof 파일은 레디스 명령어를 레디스 프로토콜 형식으로 저장하고 레디스가 재시작할 때 다시 동일한 명령어를 실행하여 데이터의 정합성을 유지한다. 또한 모든 명령어를 다시 실행하기 때문에 스냅샷에 비하여 데이터 로드 시간이 오래 걸린다. </p>
<h2 id="11장-루아-스크립트"><a href="#11장-루아-스크립트" class="headerlink" title="11장 루아 스크립트"></a>11장 루아 스크립트</h2><p>루아(lua)는 ‘달’을 의미하는 포르투갈어며, 1993년 브라질에서 처음 개발됐다. 루아 공식홈페이지에 따르면 ‘루아는 강력하고 빠르며 가벼우면서 다른 언어에 이식하기 좋은 스크립트 언어’다. 또한 대소문자를 구분한다.<br>루아 스크립트는 매우 강력한 문자열 조작함수와 수학 함수들을 가지고 있으며 쉬운 문법으로 프로그래머가 아닌 사람들도 쉽게 익히고 사용할 수 있다. 루아는 그래픽 시뮬레이션을 위한 스크립트 언어로 개발되었기 때문에 타 스크립트 언어에 비하여 빠른 성능을 제공한다. 루아 스크립트는 자바 언어와 유사한 가비지 컬렉션을 지원한다. 그러므로 사용하지 않는 변수를 메모리에서 제거하기 위해서 별도의 처리를 할 필요가 없다. 만약 사용이 완료된 변수를 즉시 가비지 컬렉션의 대상으로 만들고 싶다면 변수에 nil을 할당하면 된다. </p>
<p>레디스에서 루아를 사용하기 위해서는 몇 가지 제약사항이 따르는데, 첫 번째는 지역 변수의 사용이다. 즉, 레디스에서 루아를 사용할 때는 전역 변수를 사용하지 말아야 한다. 두 번째로 루아의 배열인 테이블을 사용할 때 첨자는 숫자로만 사용하여야 한다. </p>
<h3 id="루아-IDE-설치와-테스트"><a href="#루아-IDE-설치와-테스트" class="headerlink" title="루아 IDE 설치와 테스트"></a>루아 IDE 설치와 테스트</h3><p>이클립스 환경에서 사용 가능한 루아 개발환경은 크게 두 가지 종류가 있다. LuaEclipse와 이클립스 공식 루아 개발환경인 Koneki가 그것이다. </p>
<h3 id="루아-스크립트-언어-기본"><a href="#루아-스크립트-언어-기본" class="headerlink" title="루아 스크립트 언어 기본"></a>루아 스크립트 언어 기본</h3><h4 id="변수와-지역성"><a href="#변수와-지역성" class="headerlink" title="변수와 지역성"></a>변수와 지역성</h4><p>루아 스크립트는 다른 스크립트 언어와 유사하게 사용하는 변수형을 지정하지 않는다. 즉, 동적 변수형을 사용하며 입력된 값에 따라서 변수형이 자동으로 지정된다. 그렇기 때문에 루아에서 저장된 변수형을 확인하고자 할 때는 type 함수를 사용한다. </p>
<p>루아에서 변수를 선언할 때는 반드시 영문이나 언더스코어(_)로 시작해야 하며 예약어를 변수로 사용할 수 없다.<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">and</span> / <span class="keyword">break</span> / <span class="keyword">do</span> / <span class="keyword">else</span> / <span class="keyword">elseif</span> / <span class="keyword">end</span> / <span class="literal">false</span> / <span class="keyword">for</span> / <span class="function"><span class="keyword">function</span> / <span class="title">if</span> / <span class="title">in</span> / <span class="title">local</span> / <span class="title">nil</span> / <span class="title">not</span> / <span class="title">or</span> / <span class="title">repeat</span> / <span class="title">return</span> / <span class="title">then</span> / <span class="title">true</span> / <span class="title">until</span> / <span class="title">while</span></span></span><br></pre></td></tr></table></figure></p>
<p>루아 스크립트는 전역 변수와 지역 변수를 구분한다. 전역 변수는 프로그램의 어느 위치에서나 참조할 수 있는 반면, 지역 변수는 변수가 선언된 블록 범위 안에서만 참조할 수 있다. 루아는 전역 변수와 지역 변수의 구분이 특이한데, 특별한 지정을 하지 않으면 모두 전역 변수로 인식된다. 심지어 변수를 선언하지 않고 사용할 때에도 전역 변수로 인식한다. 또한 함수도 지역 함수와 전역 함수로 구분된다. </p>
<p>루아 스크립트에서 지역 변수나 지역 함수를 선언하기 위해서는 local 키워드를 사용한다. 레디스 공식 문서에 따르면 레디스에서 루아 스크립트를 사용할 때는 전역 변수나 전역 함수를 등록하지 말 것을 권장하고 있다. 루아 스크립트에서 사용한 전역 변수와 전역 함수가 같은 이름의 레디스 내부의 전역 변수나 전역 함수와 충돌을 일으킬 수 있기 때문이다. </p>
<h3 id="레디스에서-루아-사용하기"><a href="#레디스에서-루아-사용하기" class="headerlink" title="레디스에서 루아 사용하기"></a>레디스에서 루아 사용하기</h3><p>레디스 서버에서 수행되는 루아 스크립트에 대한 특징</p>
<ul>
<li>레디스에서 루아 스크립트를 실행할 때 스크립트에 대한 인수를 입력할 수 있다. </li>
<li>루아 스크립트에서 레디스 명령을 사용할 수 있다. </li>
<li>레디스 서버에서 실행되는 루아 스크립트는 원자적으로 처리된다. </li>
</ul>
<p>레디스에서 루아 스크립트를 실행하는 방법은 두 가지이다.<br>첫 번째는 eval 명령을 사용하여 수행하고자 하는 루아 스크립트를 매번 레디스로 전송하는 것이다.<br>두 번째는 script load 명령을 사용하여 수행할 스크립트를 레디스 서버에 미리 등록해두는 방법이다. </p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-02-11</span><i class="fa fa-tag"></i><a class="tag" href="/tags/book/" title="book">book </a><a class="tag" href="/tags/redis/" title="redis">redis </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,https://junhaesung.github.io/2018/02/11/180211-summary-9788968480591/,과제요정,이것이 레디스다 요약 (실습 제외),;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2018/02/11/180211-summary-9788966261635/" title="RESTful WEB API 요약 (2)">Post Anterior</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2018/02/05/180205-summary-9788960773431/" title="토비의 스프링 읽기 (1)">Próximo post</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>